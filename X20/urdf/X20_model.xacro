<?xml version="1.0" encoding="utf-8"?>
<robot name="X20" xmlns:xacro="http://www.ros.org/wiki/xacro">
  <xacro:property name="motor_damp" value="1.2"/>
  <xacro:property name="motor_fric" value="0.1"/>

  <link name="origin_link">
    </link>
  <joint name="origin_joint" type="fixed">
    <origin
      xyz="0 0 1"
      rpy="0 0 0"/>
    <parent link="origin_link"/>
    <child link="BASE"/>
  </joint>

  <link
    name="BASE">
    <inertial>
      <origin
        xyz="0.005 0.000413 0.004"
        rpy="0 0 0" />
      <mass
        value="26.398" />
      <inertia ixx="0.1632" ixy="-5.2136E-05" ixz="-0.00019406" iyy="0.40648" iyz="8.2679E-05" izz="0.52596" />
    </inertial>
    <visual>
      <geometry>
        <mesh
          filename="package://X20/meshes/Torso.dae" />
      </geometry>
      <material
        name="">
        <color
          rgba="0.69804 0.69804 0.69804 1" />
      </material>
    </visual>
    <collision>
      <geometry>
        <mesh
          filename="package://X20/meshes/Torso.dae" />
      </geometry>
    </collision>
  </link>

  <link name="imu_link">
    <inertial>
      <mass value="0.0000001"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.0000000001" ixy="0" ixz="0" iyy="0.00000000001" iyz="0" izz="0.000000001"/>
    </inertial>
  <visual>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <geometry>
      <box size="0.001 0.001 0.001"/>
    </geometry>
  </visual>
  <collision>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <geometry>
      <box size=".001 .001 .001"/>
    </geometry>
  </collision>
 </link>
 <joint name="imu_joint" type="fixed">
    <axis xyz="0 0 0"/> 
    <origin xyz="0 0 0"/>
    <parent link="BASE"/>
    <child link="imu_link"/>
  </joint>

  <link name="velodyne">
    <inertial>
      <mass value="0.0000001"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.0000000001" ixy="0" ixz="0" iyy="0.00000000001" iyz="0" izz="0.000000001"/>
    </inertial>
  <visual>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <geometry>
      <box size="0.01 0.01 0.01"/>
    </geometry>
  </visual>
  <collision>
    <origin rpy="0 0 0" xyz="0 0 0"/>
    <geometry>
      <box size=".001 .001 .001"/>
    </geometry>
  </collision>
 </link>
 <joint name="velodyne_joint" type="fixed">
    <axis xyz="0 0 0"/> 
    <origin xyz="0.4 0 0.2"/>
    <parent link="BASE"/>
    <child link="velodyne"/>
  </joint>

    <link name="camera_link">
    <inertial>
      <mass value="0.0000001"/>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <inertia ixx="0.0000000001" ixy="0" ixz="0" iyy="0.00000000001" iyz="0" izz="0.000000001"/>
    </inertial>
    <visual>
      <origin  xyz="0 0 0"  rpy="0 0 0" />
      <geometry>
        <mesh filename="package://X20/meshes/camera_Link.STL" />
      </geometry>
      <material name="">
        <color rgba="0.250980392156863 0.250980392156863 0.250980392156863 1" />
      </material>
    </visual>
    <collision>
      <origin xyz="0 0 0" rpy="0 0 0" />
      <geometry>
        <mesh filename="package://X20/meshes/camera_Link.STL" />
      </geometry>
    </collision>
  </link>
  <joint name="camera_to_velodyne" type="fixed">
    <origin xyz="0.013274 -0.035092 0.0245" rpy="0 0 0" />
    <parent link="velodyne" />
    <child link="camera_link" />
    <axis xyz="0 0 1" />
  </joint>

  <link name="LF_HIP">
    <inertial>
      <origin xyz="-0.00075689 -0.0089129 -5.0528E-05" />
      <mass value="1.5767" />
      <inertia ixx="0.0012141" ixy="6.1989E-06" ixz="2.8652E-06" iyy="0.0016912" iyz="3.7E-06" izz="0.0013431" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/FL_Hip.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/FL_Hip.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="A_LF_HAA" type="revolute">
    <origin xyz="0.292 0.08 0" />
    <parent link="BASE" />
    <child link="LF_HIP" />
    <axis xyz="1 0 0" />
    <limit
      lower="-0.38397"
      upper="0.38397"
      effort="126.1"
      velocity="12"  />
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="LF_THIGH">
    <inertial>
      <origin xyz="-0.0025264 -0.022118 -0.0292" />
      <mass value="3.0063" />
      <inertia ixx="0.0058102" ixy="4.2848E-05" ixz="-3.0437E-06" iyy="0.0080686" iyz="-6.889E-05" izz="0.003874" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/L_Thigh.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/L_Thigh.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="A_LF_HFE" type="revolute">
    <origin xyz="0 0.12325 0" />
    <parent link="LF_HIP" />
    <child link="LF_THIGH" />
    <axis xyz="0 -1 0" />
    <limit
      lower="-2.75762"
      upper="0.48869"
      effort="111.4"
      velocity="19"/>
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="LF_SHANK">
    <inertial>
      <origin xyz="0.0075224 2.5888E-05 -0.17586" />
      <mass value="0.54849" />
      <inertia ixx="0.0057" ixy="1.16E-07" ixz="0.000153" iyy="0.006" iyz="-1.12E-06" izz="0.00029" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/Shank.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/Shank.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="A_LF_KFE" type="revolute">
    <origin xyz="0 0 -0.3" />
    <parent link="LF_THIGH" />
    <child link="LF_SHANK" />
    <axis xyz="0 -1 0" />
    <limit
      lower="0.66322"
      upper="2.84488"
      effort="195.8"
      velocity="19"  />
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="LH_HIP">
    <inertial>
      <origin xyz="0.000757 -0.009 5.053E-05" />
      <mass value="1.5767" />
      <inertia ixx="0.00121" ixy="-6.2E-06" ixz="2.9E-06" iyy="0.0017" iyz="-3.7E-06" izz="0.00134" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/HL_Hip.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/HL_Hip.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="B_LH_HAA" type="revolute">
    <origin xyz="-0.292 0.08 0" />
    <parent link="BASE" />
    <child link="LH_HIP" />
    <axis xyz="1 0 0" />
    <limit
      lower="-0.38397"
      upper="0.38397"
      effort="126.1"
      velocity="12"  />
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="LH_THIGH">
    <inertial>
      <origin xyz="-0.0025264 -0.022118 -0.0292" />
      <mass value="3.0063" />
      <inertia ixx="0.0058102" ixy="4.2848E-05" ixz="-3.0433E-06" iyy="0.008" iyz="-6.8889E-05" izz="0.003874" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/L_Thigh.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/L_Thigh.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="B_LH_HFE" type="revolute">
    <origin xyz="0 0.12325 0" />
    <parent link="LH_HIP" />
    <child link="LH_THIGH" />
    <axis xyz="0 -1 0" />
    <limit
      lower="-2.75762"
      upper="0.48869"
      effort="111.4"
      velocity="19"/>
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="LH_SHANK">
    <inertial>
      <origin xyz="0.0075224 2.5888E-05 -0.17586" />
      <mass value="0.54849" />
      <inertia ixx="0.0057" ixy="1.16E-07" ixz="0.000153" iyy="0.006" iyz="-1.12E-06" izz="0.00029" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/Shank.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/Shank.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="B_LH_KFE" type="revolute">
    <origin xyz="0 0 -0.3" />
    <parent link="LH_THIGH" />
    <child link="LH_SHANK" />
    <axis xyz="0 -1 0" />
    <limit
      lower="0.66322"
      upper="2.84488"
      effort="195.8"
      velocity="19"  />
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="RF_HIP">
    <inertial>
      <origin xyz="-0.000757 0.009 5.0528E-05" />
      <mass value="1.5767" />
      <inertia ixx="0.0012141" ixy="-6.1989E-06" ixz="-2.8652E-06" iyy="0.0016912" iyz="3.7E-06" izz="0.0013431" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/FR_Hip.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/FR_Hip.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="A_RF_HAA" type="revolute">
    <origin xyz="0.292 -0.08 0" />
    <parent link="BASE" />
    <child link="RF_HIP" />
    <axis xyz="-1 0 0" />
    <limit
      lower="-0.38397"
      upper="0.38397"
      effort="126.1"
      velocity="12"  />
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="RF_THIGH">
    <inertial>
      <origin xyz="-0.0025266 0.022119 -0.029194" />
      <mass value="3.0062" />
      <inertia ixx="0.00581" ixy="-4.2781E-05" ixz="-3.0682E-06" iyy="0.0080684" iyz="6.8812E-05" izz="0.0038739" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/R_Thigh.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/R_Thigh.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="A_RF_HFE" type="revolute">
    <origin xyz="0 -0.12325 0" />
    <parent link="RF_HIP" />
    <child link="RF_THIGH" />
    <axis xyz="0 -1 0" />
    <limit
      lower="-2.75762"
      upper="0.48869"
      effort="111.4"
      velocity="19"/>
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="RF_SHANK">
    <inertial>
      <origin xyz="0.0075224 2.5888E-05 -0.17586" />
      <mass value="0.54849" />
      <inertia ixx="0.0057" ixy="1.16E-07" ixz="0.000153" iyy="0.006" iyz="-1.12E-06" izz="0.00029" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/Shank.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/Shank.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="A_RF_KFE" type="revolute">
    <origin xyz="0 0 -0.3" />
    <parent link="RF_THIGH" />
    <child link="RF_SHANK" />
    <axis xyz="0 -1 0" />
    <limit
      lower="0.66322"
      upper="2.84488"
      effort="195.8"
      velocity="19"  />
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="RH_HIP">
    <inertial>
      <origin xyz="0.00075689 0.0089129 -5.0528E-05" />
      <mass value="1.5767" />
      <inertia ixx="0.0012141" ixy="6.1989E-06" ixz="-2.8652E-06" iyy="0.0016912" iyz="-3.7E-06" izz="0.0013431" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/HR_Hip.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/HR_Hip.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="B_RH_HAA" type="revolute">
    <origin xyz="-0.292 -0.08 0" />
    <parent link="BASE" />
    <child link="RH_HIP" />
    <axis xyz="-1 0 0" />
    <limit
      lower="-0.38397"
      upper="0.38397"
      effort="126.1"
      velocity="12"  />
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="RH_THIGH">
    <inertial>
      <origin xyz="-0.0025266 0.022119 -0.029194" />
      <mass value="3.0062" />
      <inertia ixx="0.00581" ixy="-4.2781E-05" ixz="-3.0681E-06" iyy="0.0080684" iyz="6.8812E-05" izz="0.0038739" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/R_Thigh.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/R_Thigh.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="B_RH_HFE" type="revolute">
    <origin xyz="0 -0.12325 0" />
    <parent link="RH_HIP" />
    <child link="RH_THIGH" />
    <axis xyz="0 -1 0" />
    <limit
      lower="-2.75762"
      upper="0.48869"
      effort="111.4"
      velocity="19"/>
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="RH_SHANK">
    <inertial>
      <origin xyz="0.0075224 2.589E-05 -0.17586" />
      <mass value="0.54849" />
      <inertia ixx="0.0056981" ixy="1.1608E-07" ixz="0.00015292" iyy="0.0059026" iyz="-1.1243E-06" izz="0.00028822" />
    </inertial>
    <visual>
      <geometry>
        <mesh filename="package://X20/meshes/Shank.dae" />
      </geometry>
    </visual>
    <collision>
      <geometry>
        <mesh filename="package://X20/meshes/Shank.dae" />
      </geometry>
    </collision>
  </link>

  <joint name="B_RH_KFE" type="revolute">
    <origin xyz="0 0 -0.3" />
    <parent link="RH_THIGH" />
    <child link="RH_SHANK" />
    <axis xyz="0 -1 0" />
    <limit
      lower="0.66322"
      upper="2.84488"
      effort="195.8"
      velocity="19"  />
    <dynamics
      damping="${motor_damp}"
      friction="${motor_fric}" />
  </joint>

  <link name="LF_FOOT">
  </link>
  <joint name = "LF_FOOT_joint" type = "fixed">
    <origin xyz="0 0 -0.33" rpy = "0 0 0"/>
    <parent link="LF_SHANK"/>
    <child link = "LF_FOOT"/>
  </joint>

  <link name="LH_FOOT">
  </link>
  <joint name = "LH_FOOT_joint" type = "fixed">
    <origin xyz="0 0 -0.33" rpy = "0 0 0"/>
    <parent link="LH_SHANK"/>
    <child link = "LH_FOOT"/>
  </joint>

  <link name="RF_FOOT">
  </link>
  <joint name = "RF_FOOT_joint" type = "fixed">
    <origin xyz="0 0 -0.33" rpy = "0 0 0"/>
    <parent link="RF_SHANK"/>
    <child link = "RF_FOOT"/>
  </joint>

  <link name="RH_FOOT">
  </link>
  <joint name = "RH_FOOT_joint" type = "fixed">
    <origin xyz="0 0 -0.33" rpy = "0 0 0"/>
    <parent link="RH_SHANK"/>
    <child link = "RH_FOOT"/>
  </joint>

    <!-- ros_control plugin -->
  <gazebo>
    <plugin name="gazebo_ros_control" filename="libgazebo_ros_control.so">
      <robotNamespace>/X20</robotNamespace>
      <robotSimType>gazebo_ros_control/DefaultRobotHWSim</robotSimType>
      <legacyModeNS>true</legacyModeNS>
    </plugin>
  </gazebo>

  <gazebo reference="imu_link">
    <gravity>true</gravity>
    <sensor name="imu_sensor" type="imu">
      <always_on>true</always_on>
      <update_rate>400</update_rate>
      <visualize>true</visualize>
      <topic>/sensors/imu</topic>
      <plugin filename="libgazebo_ros_imu_sensor.so" name="imu_plugin">
        <topicName>/sensors/imu</topicName>
        <bodyName>imu_link</bodyName>
        <updateRateHZ>400.0</updateRateHZ>
        <gaussianNoise>0</gaussianNoise>
        <xyzOffset>0 0 0</xyzOffset>
        <rpyOffset>0 0 0</rpyOffset>
        <frameName>imu_link</frameName>
      </plugin>
      <pose>0 0 0 0 0 0</pose>
    </sensor>
  </gazebo>


<gazebo reference="camera_link">
    <sensor type="camera" name="camera_node">
      <update_rate>15.0</update_rate>
      <camera name="head">
        <horizontal_fov>1.0467</horizontal_fov>
        <image>
          <width>720</width>
          <height>480</height>
          <format>R8G8B8</format>
        </image>
        <clip>
          <near>0.02</near>
          <far>100</far>
        </clip>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.007</stddev>
        </noise>
      </camera>
      <plugin name="gazebo_camera" filename="libgazebo_ros_camera.so">
        <cameraName>camera</cameraName>
        <alwaysOn>true</alwaysOn>
        <updateRate>0.0</updateRate>
        <imageTopicName>rgb/image_raw</imageTopicName>
        <cameraInfoTopicName>rgb/camera_info</cameraInfoTopicName>
        <frameName>camera_link</frameName>
        <baseline>0.1</baseline>
        <distortion_k1>0.0</distortion_k1>
        <distortion_k2>0.0</distortion_k2>
        <distortion_k3>0.0</distortion_k3>
        <distortion_t1>0.0</distortion_t1>
        <distortion_t2>0.0</distortion_t2>
      </plugin>
      <pose>0 0 0 0 -0 0</pose>
    </sensor>
  </gazebo>
  <!-- Gazebo requires the velodyne_gazebo_plugins package -->
  <gazebo reference="velodyne">
    <sensor name="velodyne-VLP16" type="ray">
      <pose>0 0 0 0 0 0</pose>
      <visualize>false</visualize>
      <update_rate>10</update_rate>
      <ray>
        <scan>
          <horizontal>
            <samples>1024</samples>
            <resolution>1</resolution>
            <min_angle>-3.14159265359</min_angle>
            <max_angle>3.14159265359</max_angle>
          </horizontal>
          <vertical>
            <samples>16</samples>
            <resolution>1</resolution>
            <min_angle>-0.261799387799</min_angle>
            <max_angle> 0.261799387799</max_angle>
          </vertical>
        </scan>
        <range>
          <min>0.3</min>
          <max>101</max>
          <resolution>0.001</resolution>
        </range>
        <noise>
          <type>gaussian</type>
          <mean>0.0</mean>
          <stddev>0.0</stddev>
        </noise>
      </ray>
      <plugin filename="libgazebo_ros_velodyne_laser.so" name="gazebo_ros_laser_controller">
        <topicName>velodyne_points</topicName>
        <frameName>velodyne</frameName>
        <min_range>0.9</min_range>
        <max_range>100</max_range>
        <gaussianNoise>0.008</gaussianNoise>
      </plugin>
    </sensor>
  </gazebo>

  <!-- Joint 'implicitSpringDamper' setup, according to official website's suggestion-->
  <xacro:macro name="joint_setup_block" params="joint_name">
    <gazebo reference="${joint_name}">
      <implicitSpringDamper>1</implicitSpringDamper>
    </gazebo>
  </xacro:macro>
  <xacro:joint_setup_block joint_name="A_LF_HAA"/>
  <xacro:joint_setup_block joint_name="A_LF_HFE"/>
  <xacro:joint_setup_block joint_name="A_LF_KFE"/>
  <xacro:joint_setup_block joint_name="A_RF_HAA"/>
  <xacro:joint_setup_block joint_name="A_RF_HFE"/>
  <xacro:joint_setup_block joint_name="A_RF_KFE"/>
  <xacro:joint_setup_block joint_name="B_LH_HAA"/>
  <xacro:joint_setup_block joint_name="B_LH_HFE"/>
  <xacro:joint_setup_block joint_name="B_LH_KFE"/>
  <xacro:joint_setup_block joint_name="B_RH_HAA"/>
  <xacro:joint_setup_block joint_name="B_RH_HFE"/>
  <xacro:joint_setup_block joint_name="B_RH_KFE"/>

  <!-- Link setup-->
  <xacro:macro name="link_setup_block" params="link_name">
    <gazebo reference="${link_name}">
      <kp>1000000.0</kp>
      <kd>1.0</kd>
      <mu1>1.0</mu1>
      <mu2>1.0</mu2>
      <minDepth>0.001</minDepth>
    </gazebo>
  </xacro:macro>
  <xacro:link_setup_block link_name="LF_SHANK"/>  
  <xacro:link_setup_block link_name="LH_SHANK"/>
  <xacro:link_setup_block link_name="RF_SHANK"/>
  <xacro:link_setup_block link_name="RH_SHANK"/>
  
  <xacro:macro name="link_setup_block2" params="link_name">
    <gazebo reference="${link_name}">
      <kp>1000000.0</kp>
      <kd>1.0</kd>
      <mu1>0.8</mu1>
      <mu2>0.8</mu2>
      <minDepth>0.001</minDepth>
    </gazebo>
  </xacro:macro>
  <xacro:link_setup_block2 link_name="LF_HIP"/>
  <xacro:link_setup_block2 link_name="LF_THIGH"/>
  <xacro:link_setup_block2 link_name="RF_HIP"/>
  <xacro:link_setup_block2 link_name="RF_THIGH"/>
  <xacro:link_setup_block2 link_name="LH_HIP"/>
  <xacro:link_setup_block2 link_name="LH_THIGH"/>
  <xacro:link_setup_block2 link_name="RH_HIP"/>
  <xacro:link_setup_block2 link_name="RH_THIGH"/>

</robot>